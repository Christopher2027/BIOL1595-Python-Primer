import pandas as pd
import numpy as np

from sklearn.cluster import KMeans
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import precision_score, recall_score, f1_score, classification_report

# Load the dataset
df = pd.read_csv('data/hd_data.csv')

X = df[['Age', 'BP', 'Cholesterol', 'Max HR']]

y = df['Heart Disease'].replace({'Absence': 0, 'Presence': 1})

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.3, random_state=42, stratify=y
)

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

model = KMeans(n_clusters=2, random_state=42, n_init=10)
model.fit(X_train_scaled)

test_clusters = model.predict(X_test_scaled)

train_clusters = model.labels_
cluster_to_label = {}
for c in np.unique(train_clusters):
    cluster_to_label[c] = int(y_train[train_clusters == c].mean() >= 0.5)

y_pred = np.array([cluster_to_label[c] for c in test_clusters])

# Precision, Recall, F1

precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)

print("Classification precision:", precision)
print("Classification recall:", recall)
print("Classification f1:", f1)

# Classification precision: 0.6304347826086957
# Classification recall: 0.8055555555555556
# Classification f1: 0.7073170731707317

