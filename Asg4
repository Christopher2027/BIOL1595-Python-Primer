import pandas as pd
import numpy as np

from sklearn.cluster import KMeans
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import precision_score, recall_score, f1_score, classification_report

#Load the dataset
df = pd.read_csv('data/hd_data.csv')

#Features: Age, BP, Cholesterol, Max HR
X = df[['Age', 'BP', 'Cholesterol', 'Max HR']]
Y = df['Heart Disease'].replace({'Absence': 0, 'Presence': 1})

#Split data into training and testing sets
Xtrain, Xtest, Ytrain, Ytest = train_test_split(X, Y, test_size=0.3, random_state=42, stratify=Y)

#Cluster model

scaler = StandardScaler()
Xtrain_scaled = scaler.fit_transform(Xtrain)
Xtest_scaled = scaler.transform(Xtest)
model = KMeans(n_clusters=2, random_state=42, n_init=10)
model.fit(Xtrain_scaled)
test_clusters = model.predict(Xtest_scaled)

train_clusters = model.labels_
cluster_to_label = {}
for c in np.unique(train_clusters):
   cluster_to_label[c] = int(Ytrain[train_clusters == c].mean() >= 0.5)

YPredict = np.array([cluster_to_label[c] for c in test_clusters])

#Precision, Recall, F1
precision = precision_score(Ytest, YPredict)
recall = recall_score(Ytest, YPredict)
f1 = f1_score(Ytest, YPredict)
print("Classification precision:", precision)
print("Classification recall:", recall)
print("Classification f1:", f1)

# Classification precision: 0.6304347826086957
# Classification recall: 0.8055555555555556
# Classification f1: 0.7073170731707317